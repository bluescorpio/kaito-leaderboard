<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•è¯Šæ–­ - Kaitoæ’è¡Œæ¦œåŠ è½½é—®é¢˜</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; background: #f0fff0; }
        .error { color: red; background: #fff0f0; }
        .warning { color: orange; background: #fff8f0; }
        .info { color: blue; background: #f0f8ff; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; border-radius: 3px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        #console-logs { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; max-height: 200px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Kaitoæ’è¡Œæ¦œåŠ è½½é—®é¢˜è¯Šæ–­å·¥å…·</h1>
        
        <div class="grid">
            <div class="debug-section">
                <h2>1. é…ç½®æ£€æŸ¥</h2>
                <button onclick="checkConfig()">æ£€æŸ¥é…ç½®</button>
                <div id="config-result"></div>
            </div>

            <div class="debug-section">
                <h2>2. æ–‡ä»¶çŠ¶æ€</h2>
                <button onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶</button>
                <div id="files-result"></div>
            </div>

            <div class="debug-section">
                <h2>3. æ•°æ®åŠ è½½</h2>
                <button onclick="testDataLoading()">æµ‹è¯•æ•°æ®</button>
                <div id="data-result"></div>
            </div>

            <div class="debug-section">
                <h2>4. DOM æ£€æŸ¥</h2>
                <button onclick="checkDOM()">æ£€æŸ¥é¡µé¢å…ƒç´ </button>
                <div id="dom-result"></div>
            </div>
        </div>

        <div class="debug-section">
            <h2>5. å®Œæ•´è¯Šæ–­</h2>
            <button onclick="runFullDiagnosis()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
            <div id="full-result"></div>
        </div>

        <div class="debug-section">
            <h2>6. æ§åˆ¶å°æ—¥å¿—</h2>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            <div id="console-logs"></div>
        </div>
    </div>

    <script>
        // é¡¹ç›®é…ç½®
        const KAITO_CONFIG = {
            PRE_TGE_PROJECTS: [
                "0G", "ALLORA", "ANOMA", "BILLIONS", "BLS", "BOUNDLESS", "CAMP", "CYSIC", 
                "EVERLYN", "FALCON", "FOGO", "HANAHANA", "GOATNETWORK", "INFINEX", "IRYS", 
                "KAT", "LOMBARD", "LUMITERRA", "MAVRYK", "MEGAETH", "MEMEX", "MIRA", "MITOSIS", 
                "MOMENTUM", "MONAD", "MOONBIRDS", "MULTIBANK", "MULTIPLI", "NYT", "NOYA", "OPENLEDGER",
                "PARADEX", "PORTALPORTAL", "PUFFPAW", "SAPIEN", "SOMNIA", "SO", "SURF", 
                "SYMPHONY", "THEORIQ", "THRIVE", "TURTLECLUB", "UNION", "WARP", "YEET"
            ],
            POST_TGE_PROJECTS: [
                "KAITO", "ANIME", "APT", "ARB", "BERA", "BLUE", "BOOPBOOPFUN", "BYBITTRADFI", 
                "CALDERA", "CORN", "CREATORBID", "DEFIAPP", "DYDX", "ECLIPSE", "ETH", "FRAX", 
                "FUEL", "HUMAFINANCE", "HUMANITY", "INFINIT", "INITIA", "INJ", "IQ", "KAIA", 
                "KINTO", "MNT", "OM", "MAPLESTORYUNIVERSE", "MOVEMENT", "NEAR", "NEWTON", 
                "ORDERLYNETWORK", "PEAQ", "PENGU", "DOT", "POL", "PYTH", "QUAI", "SATLAYER", 
                "SEI", "SIDEKICK", "SKATE", "S", "SOON", "SOPHON", "STARKNET", "STORYPROTOCOL", 
                "SUCCINCT", "UXLINK", "VIRTUALECOSYSTEM", "WAL", "WAYFINDER", "XION", "ZEC"
            ]
        };

        let kolJsonData = null;

        // æ‹¦æˆªconsoleè¾“å‡º
        const originalConsole = { ...console };
        
        console.log = function(...args) {
            originalConsole.log.apply(console, args);
            logToConsole('INFO', args.join(' '));
        };
        
        console.error = function(...args) {
            originalConsole.error.apply(console, args);
            logToConsole('ERROR', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalConsole.warn.apply(console, args);
            logToConsole('WARN', args.join(' '));
        };

        function logToConsole(level, message) {
            const logsDiv = document.getElementById('console-logs');
            const timestamp = new Date().toLocaleTimeString();
            const color = {INFO: '#4CAF50', ERROR: '#f44336', WARN: '#ff9800'}[level] || '#2196F3';
            logsDiv.innerHTML += `<div style="color: ${color}; margin: 2px 0;">[${timestamp}] ${level}: ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('console-logs').innerHTML = '';
        }

        function checkConfig() {
            const result = document.getElementById('config-result');
            result.innerHTML = '<p>æ£€æŸ¥ä¸­...</p>';
            
            try {
                console.log('å¼€å§‹æ£€æŸ¥ KAITO_CONFIG...');
                
                const checks = [
                    { name: 'KAITO_CONFIG å·²å®šä¹‰', pass: typeof KAITO_CONFIG !== 'undefined' },
                    { name: 'PRE_TGE_PROJECTS å­˜åœ¨', pass: KAITO_CONFIG?.PRE_TGE_PROJECTS?.length > 0 },
                    { name: 'POST_TGE_PROJECTS å­˜åœ¨', pass: KAITO_CONFIG?.POST_TGE_PROJECTS?.length > 0 },
                    { name: 'APT åœ¨ POST_TGE ä¸­', pass: KAITO_CONFIG?.POST_TGE_PROJECTS?.includes('APT') }
                ];
                
                const preCount = KAITO_CONFIG?.PRE_TGE_PROJECTS?.length || 0;
                const postCount = KAITO_CONFIG?.POST_TGE_PROJECTS?.length || 0;
                
                const html = `
                    ${checks.map(check => `
                        <p class="${check.pass ? 'success' : 'error'}">
                            ${check.pass ? 'âœ…' : 'âŒ'} ${check.name}
                        </p>
                    `).join('')}
                    <p>PRE_TGE: ${preCount} ä¸ªé¡¹ç›®</p>
                    <p>POST_TGE: ${postCount} ä¸ªé¡¹ç›®</p>
                    <p>æ€»è®¡: ${preCount + postCount} ä¸ªé¡¹ç›®</p>
                `;
                
                result.innerHTML = html;
                result.className = checks.every(c => c.pass) ? 'success' : 'error';
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ é…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
                console.error('é…ç½®æ£€æŸ¥é”™è¯¯:', error);
            }
        }

        async function checkFiles() {
            const result = document.getElementById('files-result');
            result.innerHTML = '<p>æ£€æŸ¥ä¸­...</p>';
            
            try {
                console.log('å¼€å§‹æ£€æŸ¥æ–‡ä»¶å¯è®¿é—®æ€§...');
                
                const files = [
                    { name: 'kol.json', path: './kol.json' },
                    { name: 'config.js', path: './config.js' },
                    { name: 'production.html', path: './production.html' }
                ];
                
                const results = [];
                
                for (const file of files) {
                    try {
                        const response = await fetch(file.path);
                        const size = response.headers.get('Content-Length');
                        results.push({
                            name: file.name,
                            status: response.status,
                            ok: response.ok,
                            size: size ? parseInt(size) : 0
                        });
                    } catch (error) {
                        results.push({
                            name: file.name,
                            ok: false,
                            error: error.message
                        });
                    }
                }
                
                const html = results.map(r => `
                    <p class="${r.ok ? 'success' : 'error'}">
                        ${r.ok ? 'âœ…' : 'âŒ'} ${r.name}: ${r.status || 'ERROR'} 
                        ${r.size ? `(${(r.size/1024/1024).toFixed(2)} MB)` : ''}
                        ${r.error ? `- ${r.error}` : ''}
                    </p>
                `).join('');
                
                result.innerHTML = html;
                result.className = results.every(r => r.ok) ? 'success' : 'error';
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ æ–‡ä»¶æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
                console.error('æ–‡ä»¶æ£€æŸ¥é”™è¯¯:', error);
            }
        }

        async function testDataLoading() {
            const result = document.getElementById('data-result');
            result.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            
            try {
                console.log('å¼€å§‹æµ‹è¯•æ•°æ®åŠ è½½...');
                
                const response = await fetch('./kol.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                kolJsonData = await response.json();
                
                const checks = [
                    { name: 'æ•°æ®åŠ è½½æˆåŠŸ', pass: !!kolJsonData },
                    { name: 'categories ç»“æ„å­˜åœ¨', pass: !!kolJsonData?.categories },
                    { name: 'pre_tge æ•°æ®å­˜åœ¨', pass: !!kolJsonData?.categories?.pre_tge },
                    { name: 'post_tge æ•°æ®å­˜åœ¨', pass: !!kolJsonData?.categories?.post_tge },
                    { name: 'APT é¡¹ç›®æ•°æ®å­˜åœ¨', pass: !!kolJsonData?.categories?.post_tge?.APT },
                    { name: 'APT 7d æ•°æ®å­˜åœ¨', pass: !!kolJsonData?.categories?.post_tge?.APT?.['7d'] }
                ];
                
                const aptData = kolJsonData?.categories?.post_tge?.APT?.['7d'];
                const preProjects = Object.keys(kolJsonData?.categories?.pre_tge || {}).length;
                const postProjects = Object.keys(kolJsonData?.categories?.post_tge || {}).length;
                
                const html = `
                    ${checks.map(check => `
                        <p class="${check.pass ? 'success' : 'error'}">
                            ${check.pass ? 'âœ…' : 'âŒ'} ${check.name}
                        </p>
                    `).join('')}
                    <p>PRE_TGE é¡¹ç›®: ${preProjects}</p>
                    <p>POST_TGE é¡¹ç›®: ${postProjects}</p>
                    <p>APT 7d æ•°æ®: ${aptData ? aptData.length : 0} æ¡</p>
                    <p>æ•°æ®å¤§å°: ${(JSON.stringify(kolJsonData).length / 1024 / 1024).toFixed(2)} MB</p>
                `;
                
                result.innerHTML = html;
                result.className = checks.every(c => c.pass) ? 'success' : 'error';
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ æ•°æ®åŠ è½½å¤±è´¥: ${error.message}</p>`;
                console.error('æ•°æ®åŠ è½½é”™è¯¯:', error);
            }
        }

        function checkDOM() {
            const result = document.getElementById('dom-result');
            
            try {
                console.log('å¼€å§‹æ£€æŸ¥ DOM å…ƒç´ ...');
                
                // æ£€æŸ¥ç”Ÿäº§é¡µé¢çš„å…³é”®å…ƒç´ ï¼ˆå¦‚æœæ˜¯åœ¨ç”Ÿäº§é¡µé¢è¿è¡Œï¼‰
                const elements = [
                    'category-select',
                    'topic-select', 
                    'duration-select',
                    'top-n-select',
                    'loading',
                    'users-grid'
                ];
                
                const checks = elements.map(id => ({
                    name: `#${id} å…ƒç´ `,
                    pass: !!document.getElementById(id)
                }));
                
                // æ£€æŸ¥åŸºæœ¬DOMçŠ¶æ€
                checks.push({ name: 'DOM å·²å°±ç»ª', pass: document.readyState === 'complete' });
                checks.push({ name: 'é¡µé¢å·²åŠ è½½', pass: window.location.href !== 'about:blank' });
                
                const html = checks.map(check => `
                    <p class="${check.pass ? 'success' : 'warning'}">
                        ${check.pass ? 'âœ…' : 'âš ï¸'} ${check.name}
                    </p>
                `).join('');
                
                result.innerHTML = html + '<p class="info">ğŸ’¡ å¦‚æœæŸäº›å…ƒç´ ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯å› ä¸ºè¿™æ˜¯è°ƒè¯•é¡µé¢è€Œéç”Ÿäº§é¡µé¢</p>';
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ DOM æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
                console.error('DOM æ£€æŸ¥é”™è¯¯:', error);
            }
        }

        async function runFullDiagnosis() {
            const result = document.getElementById('full-result');
            result.innerHTML = '<p>æ­£åœ¨è¿è¡Œå®Œæ•´è¯Šæ–­...</p>';
            
            try {
                console.log('å¼€å§‹å®Œæ•´è¯Šæ–­...');
                
                // è¿è¡Œæ‰€æœ‰æ£€æŸ¥
                checkConfig();
                await new Promise(resolve => setTimeout(resolve, 500));
                await checkFiles();
                await new Promise(resolve => setTimeout(resolve, 500));
                await testDataLoading();
                await new Promise(resolve => setTimeout(resolve, 500));
                checkDOM();
                
                // è¯Šæ–­ç»“æœæ€»ç»“
                const issues = [];
                
                if (typeof KAITO_CONFIG === 'undefined') {
                    issues.push('âŒ KAITO_CONFIG æœªå®šä¹‰ - è¿™æ˜¯ä¸»è¦é—®é¢˜ï¼');
                }
                
                if (!kolJsonData) {
                    issues.push('âŒ æ— æ³•åŠ è½½ kol.json æ•°æ®');
                }
                
                if (!kolJsonData?.categories?.post_tge?.APT?.['7d']) {
                    issues.push('âŒ ç¼ºå°‘é»˜è®¤ APT 7d æ•°æ®');
                }
                
                const summary = issues.length === 0 
                    ? '<p class="success">âœ… æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡ï¼é¡µé¢åº”è¯¥èƒ½æ­£å¸¸åŠ è½½ã€‚</p>'
                    : `<p class="error">å‘ç° ${issues.length} ä¸ªé—®é¢˜ï¼š</p><ul>${issues.map(issue => `<li>${issue}</li>`).join('')}</ul>`;
                
                const recommendations = `
                    <h4>ğŸ”§ ä¿®å¤å»ºè®®ï¼š</h4>
                    <ol>
                        <li>ç¡®ä¿ production.html ä¸­å®šä¹‰äº† KAITO_CONFIG</li>
                        <li>éªŒè¯ kol.json æ–‡ä»¶å­˜åœ¨ä¸”å¯è®¿é—®</li>
                        <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯</li>
                        <li>å°è¯•ç¡¬åˆ·æ–°é¡µé¢ (Ctrl+F5 æˆ– Cmd+Shift+R)</li>
                        <li>ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½å·²æ­£ç¡®éƒ¨ç½²</li>
                    </ol>
                `;
                
                result.innerHTML = summary + recommendations;
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ å®Œæ•´è¯Šæ–­å¤±è´¥: ${error.message}</p>`;
                console.error('å®Œæ•´è¯Šæ–­é”™è¯¯:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæ£€æŸ¥
        window.addEventListener('load', function() {
            console.log('è°ƒè¯•å·¥å…·å·²åŠ è½½');
            logToConsole('INFO', 'è°ƒè¯•å·¥å…·åˆå§‹åŒ–å®Œæˆ');
            setTimeout(() => {
                checkConfig();
            }, 1000);
        });
    </script>
</body>
</html>
