<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç¯å¢ƒè°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-item { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        .loading { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .log { max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç”Ÿäº§ç¯å¢ƒè°ƒè¯•å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·å¸®åŠ©è¯Šæ–­ç”Ÿäº§ç¯å¢ƒä¸­æ•°æ®åŠ è½½çš„é—®é¢˜</p>
        
        <div class="test-item loading" id="environment-check">
            <h3>ğŸ“ ç¯å¢ƒæ£€æµ‹</h3>
            <p id="env-info">æ­£åœ¨æ£€æµ‹ç¯å¢ƒ...</p>
        </div>
        
        <div class="test-item" id="kol-json-test">
            <h3>ğŸ“„ kol.json æ–‡ä»¶æµ‹è¯•</h3>
            <button onclick="testKolJson()">æµ‹è¯• kol.json åŠ è½½</button>
            <div id="kol-json-result"></div>
        </div>
        
        <div class="test-item" id="api-test">
            <h3>ğŸ”— API è¿æ¥æµ‹è¯•</h3>
            <button onclick="testAPI()">æµ‹è¯• API è¿æ¥</button>
            <div id="api-result"></div>
        </div>
        
        <div class="test-item" id="data-load-test">
            <h3>ğŸ“Š æ•°æ®åŠ è½½æµ‹è¯•</h3>
            <button onclick="testDataLoad()">æµ‹è¯•å®Œæ•´æ•°æ®åŠ è½½æµç¨‹</button>
            <div id="data-load-result"></div>
        </div>
        
        <div class="test-item" id="console-logs">
            <h3>ğŸ“ æ§åˆ¶å°æ—¥å¿—</h3>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            <div id="log-container" class="log"></div>
        </div>
    </div>

    <script>
        let logs = [];

        // æ‹¦æˆª console è¾“å‡º
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${type}: ${message}`);
            updateLogDisplay();
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('LOG', args.join(' '));
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('WARN', args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR', args.join(' '));
        };

        function updateLogDisplay() {
            const container = document.getElementById('log-container');
            container.innerHTML = '<pre>' + logs.slice(-20).join('\n') + '</pre>';
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            logs = [];
            updateLogDisplay();
        }

        // ç¯å¢ƒæ£€æµ‹
        function detectEnvironment() {
            const envInfo = document.getElementById('env-info');
            const envCheck = document.getElementById('environment-check');
            
            const info = {
                domain: window.location.hostname,
                protocol: window.location.protocol,
                port: window.location.port,
                pathname: window.location.pathname,
                userAgent: navigator.userAgent.substring(0, 100) + '...'
            };
            
            envInfo.innerHTML = `
                <strong>å½“å‰ç¯å¢ƒä¿¡æ¯:</strong><br>
                åŸŸå: ${info.domain}<br>
                åè®®: ${info.protocol}<br>
                ç«¯å£: ${info.port || 'é»˜è®¤'}<br>
                è·¯å¾„: ${info.pathname}<br>
                <small>æµè§ˆå™¨: ${info.userAgent}</small>
            `;
            
            if (info.domain === 'localhost' || info.domain === '127.0.0.1') {
                envCheck.className = 'test-item warning';
                envInfo.innerHTML += '<br><strong>âš ï¸ æ£€æµ‹åˆ°æœ¬åœ°ç¯å¢ƒ</strong>';
            } else {
                envCheck.className = 'test-item success';
                envInfo.innerHTML += '<br><strong>âœ… æ£€æµ‹åˆ°ç”Ÿäº§ç¯å¢ƒ</strong>';
            }
            
            console.log('ç¯å¢ƒæ£€æµ‹å®Œæˆ:', info);
        }

        // æµ‹è¯• kol.json åŠ è½½
        async function testKolJson() {
            const result = document.getElementById('kol-json-result');
            result.innerHTML = '<p>æ­£åœ¨æµ‹è¯• kol.json...</p>';
            
            try {
                console.log('å¼€å§‹æµ‹è¯• kol.json åŠ è½½...');
                const response = await fetch('./kol.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                result.innerHTML = `
                    <div class="success">
                        <p><strong>âœ… kol.json åŠ è½½æˆåŠŸ</strong></p>
                        <p>æ–‡ä»¶å¤§å°: ${response.headers.get('content-length') || 'æœªçŸ¥'} bytes</p>
                        <p>é¡¹ç›®æ€»æ•°: ${data.totalProjects || 'æœªçŸ¥'}</p>
                        <p>æœ€åæ›´æ–°: ${data.lastUpdate || 'æœªçŸ¥'}</p>
                        <p>æ•°æ®ç±»åˆ«: ${data.categories ? Object.keys(data.categories).length : 0} ä¸ª</p>
                    </div>
                `;
                console.log('âœ… kol.json æµ‹è¯•æˆåŠŸ', data);
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <p><strong>âŒ kol.json åŠ è½½å¤±è´¥</strong></p>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                        <ul>
                            <li>ç¡®ä¿ kol.json æ–‡ä»¶å­˜åœ¨äºç½‘ç«™æ ¹ç›®å½•</li>
                            <li>æ£€æŸ¥æ–‡ä»¶æƒé™å’ŒæœåŠ¡å™¨é…ç½®</li>
                            <li>ç¡®è®¤æ–‡ä»¶æ ¼å¼æ­£ç¡®</li>
                        </ul>
                    </div>
                `;
                console.error('âŒ kol.json æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // æµ‹è¯• API è¿æ¥
        async function testAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<p>æ­£åœ¨æµ‹è¯• API è¿æ¥...</p>';
            
            try {
                console.log('å¼€å§‹æµ‹è¯• API è¿æ¥...');
                const testUrl = '/api/kol/mindshare/top-leaderboard?duration=7d&topic_id=BITCOIN&top_n=10&community_tier=tier1&customized_community=customized&community_yaps=true';
                const response = await fetch(testUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                result.innerHTML = `
                    <div class="success">
                        <p><strong>âœ… API è¿æ¥æˆåŠŸ</strong></p>
                        <p>è¿”å›æ•°æ®æ¡æ•°: ${Array.isArray(data) ? data.length : 'éæ•°ç»„æ ¼å¼'}</p>
                        <p>æ•°æ®ç¤ºä¾‹: ${JSON.stringify(data).substring(0, 100)}...</p>
                    </div>
                `;
                console.log('âœ… API æµ‹è¯•æˆåŠŸ', data);
                
            } catch (error) {
                result.innerHTML = `
                    <div class="warning">
                        <p><strong>âš ï¸ API è¿æ¥å¤±è´¥ (è¿™åœ¨çº¯é™æ€éƒ¨ç½²ä¸­æ˜¯æ­£å¸¸çš„)</strong></p>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p><strong>è¯´æ˜:</strong> ç”Ÿäº§ç¯å¢ƒé€šå¸¸ä½¿ç”¨æœ¬åœ° JSON æ–‡ä»¶è€Œä¸æ˜¯ API</p>
                    </div>
                `;
                console.warn('âš ï¸ API æµ‹è¯•å¤±è´¥ (é¢„æœŸ):', error);
            }
        }

        // æµ‹è¯•å®Œæ•´æ•°æ®åŠ è½½æµç¨‹
        async function testDataLoad() {
            const result = document.getElementById('data-load-result');
            result.innerHTML = '<p>æ­£åœ¨æµ‹è¯•æ•°æ®åŠ è½½æµç¨‹...</p>';
            
            try {
                console.log('å¼€å§‹æµ‹è¯•å®Œæ•´æ•°æ®åŠ è½½æµç¨‹...');
                
                // æ¨¡æ‹Ÿå®é™…çš„æ•°æ®åŠ è½½è¿‡ç¨‹
                let kolJsonData = null;
                
                // 1. å°è¯•åŠ è½½ kol.json
                try {
                    const response = await fetch('./kol.json');
                    if (response.ok) {
                        kolJsonData = await response.json();
                        console.log('âœ… æˆåŠŸåŠ è½½ kol.json');
                    } else {
                        throw new Error(`æ— æ³•åŠ è½½ kol.json: ${response.status}`);
                    }
                } catch (error) {
                    console.error('âŒ kol.json åŠ è½½å¤±è´¥:', error);
                    throw error;
                }
                
                // 2. æµ‹è¯•æ•°æ®æå–
                if (kolJsonData && kolJsonData.categories) {
                    const categories = Object.keys(kolJsonData.categories);
                    console.log('å¯ç”¨æ•°æ®ç±»åˆ«:', categories);
                    
                    // å°è¯•è·å–ç¬¬ä¸€ä¸ªç±»åˆ«çš„æ•°æ®
                    if (categories.length > 0) {
                        const firstCategory = kolJsonData.categories[categories[0]];
                        const projects = Object.keys(firstCategory);
                        console.log(`ç±»åˆ« ${categories[0]} åŒ…å«é¡¹ç›®:`, projects.slice(0, 5));
                        
                        if (projects.length > 0) {
                            const firstProject = firstCategory[projects[0]];
                            const durations = Object.keys(firstProject);
                            console.log(`é¡¹ç›® ${projects[0]} åŒ…å«æ—¶é—´æ®µ:`, durations);
                        }
                    }
                }
                
                result.innerHTML = `
                    <div class="success">
                        <p><strong>âœ… æ•°æ®åŠ è½½æµç¨‹æµ‹è¯•æˆåŠŸ</strong></p>
                        <p>æ•°æ®æ–‡ä»¶: kol.json æ­£å¸¸</p>
                        <p>æ•°æ®ç»“æ„: å®Œæ•´</p>
                        <p><strong>å»ºè®®:</strong> æ•°æ®åŠ è½½åŠŸèƒ½æ­£å¸¸ï¼Œå¯èƒ½æ˜¯å‰ç«¯æ¸²æŸ“é€»è¾‘é—®é¢˜</p>
                    </div>
                `;
                console.log('âœ… æ•°æ®åŠ è½½æµç¨‹æµ‹è¯•æˆåŠŸ');
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <p><strong>âŒ æ•°æ®åŠ è½½æµç¨‹å¤±è´¥</strong></p>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                        <ul>
                            <li>æ£€æŸ¥ kol.json æ–‡ä»¶æ˜¯å¦æ­£ç¡®éƒ¨ç½²</li>
                            <li>ç¡®è®¤ç½‘ç«™å¯ä»¥è®¿é—®é™æ€æ–‡ä»¶</li>
                            <li>æ£€æŸ¥æµè§ˆå™¨ç½‘ç»œé¢æ¿ä¸­çš„å…·ä½“é”™è¯¯</li>
                        </ul>
                    </div>
                `;
                console.error('âŒ æ•°æ®åŠ è½½æµç¨‹å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œç¯å¢ƒæ£€æµ‹
        window.addEventListener('load', function() {
            detectEnvironment();
            console.log('ğŸ”§ ç”Ÿäº§ç¯å¢ƒè°ƒè¯•å·¥å…·å·²åŠ è½½');
        });
    </script>
</body>
</html>
